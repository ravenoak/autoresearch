task: [coverage] echo "[coverage] syncing dependencies"
[coverage] syncing dependencies
task: [coverage] uv sync \
   --extra dev-minimal --extra test --extra nlp --extra ui --extra vss --extra git --extra distributed --extra analysis --extra llm --extra parsers --extra gpu \
  

Resolved 328 packages in 7ms
Downloading nvidia-cusparselt-cu12 (273.9MiB)
Downloading nvidia-nvjitlink-cu12 (37.4MiB)
Downloading nvidia-cusparse-cu12 (274.9MiB)
Downloading language-data (5.1MiB)
Downloading scipy (34.0MiB)
Downloading hf-xet (3.0MiB)
Downloading nvidia-cufft-cu12 (184.2MiB)
Downloading triton (148.4MiB)
Downloading nvidia-cublas-cu12 (566.8MiB)
Downloading nvidia-cuda-nvrtc-cu12 (84.0MiB)
Downloading nvidia-cudnn-cu12 (674.0MiB)
Downloading nvidia-curand-cu12 (60.7MiB)
Downloading numba (3.3MiB)
Downloading nvidia-nccl-cu12 (307.4MiB)
Downloading spacy (32.4MiB)
Downloading duckdb-extension-vss (15.7MiB)
Downloading nvidia-cusolver-cu12 (255.1MiB)
Downloading polars (37.9MiB)
Downloading streamlit (9.6MiB)
Downloading torch (846.8MiB)
Downloading blis (11.1MiB)
Downloading llvmlite (53.7MiB)
Downloading ray (66.9MiB)
Downloading pandas (11.4MiB)
Downloading pydeck (6.6MiB)
Downloading nvidia-cuda-cupti-cu12 (9.8MiB)
Downloading transformers (11.1MiB)
Downloading thinc (4.1MiB)
Downloading nvidia-cufile-cu12 (1.1MiB)
Downloading sympy (6.0MiB)
Downloading pillow (6.3MiB)
Downloading plotly (9.3MiB)
Downloading litellm (8.7MiB)
Downloading srsly (1.1MiB)
Downloading onnxruntime (16.5MiB)
Downloading pyarrow (40.8MiB)
Downloading scikit-learn (9.0MiB)
Downloading tokenizers (3.1MiB)
Downloading marisa-trie (1.2MiB)
 Downloading nvidia-cufile-cu12
 Downloading marisa-trie
 Downloading hf-xet
 Downloading tokenizers
 Downloading srsly
   Building madoka==0.7.1
   Building hdbscan==0.8.40
 Downloading pydeck
 Downloading pillow
 Downloading thinc
 Downloading nvidia-cuda-cupti-cu12
 Downloading blis
 Downloading duckdb-extension-vss
 Downloading streamlit
 Downloading nvidia-nvjitlink-cu12
 Downloading numba
 Downloading onnxruntime
 Downloading polars
 Downloading language-data
 Downloading scikit-learn
 Downloading llvmlite
 Downloading nvidia-curand-cu12
 Downloading litellm
 Downloading pyarrow
 Downloading sympy
 Downloading nvidia-cuda-nvrtc-cu12
 Downloading pandas
 Downloading spacy
 Downloading plotly
 Downloading transformers
 Downloading scipy
      Built madoka==0.7.1
 Downloading triton
 Downloading ray
 Downloading nvidia-cufft-cu12
 Downloading nvidia-cusolver-cu12
 Downloading nvidia-cusparselt-cu12
 Downloading nvidia-cusparse-cu12
 Downloading nvidia-nccl-cu12
 Downloading nvidia-cublas-cu12
 Downloading nvidia-cudnn-cu12
 Downloading torch
      Built hdbscan==0.8.40
Prepared 103 packages in 2m 12s
Installed 103 packages in 374ms
 + alembic==1.16.5
 + altair==5.5.0
 + asyncer==0.0.8
 + backoff==2.2.1
 + bertopic==0.17.3
 + blinker==1.9.0
 + blis==1.3.0
 + catalogue==2.0.10
 + cloudpathlib==0.22.0
 + cloudpickle==3.1.1
 + coloredlogs==15.0.1
 + colorlog==6.9.0
 + confection==0.1.5
 + cymem==2.0.11
 + diskcache==5.6.3
 + dspy==3.0.3
 + dspy-ai==3.0.3
 + duckdb-extension-vss==1.3.2
 + fastembed==0.7.3
 + fastuuid==0.13.5
 + filelock==3.19.1
 + flatbuffers==25.9.23
 + fsspec==2025.9.0
 + gepa==0.0.7
 + gitdb==4.0.12
 + gitpython==3.1.45
 + hdbscan==0.8.40
 + hf-xet==1.1.10
 + httpx-ws==0.8.0
 + huggingface-hub==0.35.1
 + humanfriendly==10.0
 + jinja2==3.1.6
 + joblib==1.5.2
 + json-repair==0.51.0
 + langcodes==3.5.0
 + language-data==1.3.0
 + litellm==1.77.4
 + llvmlite==0.45.0
 + lmstudio==1.5.0
 + madoka==0.7.1
 + magicattr==0.1.6
 + marisa-trie==1.3.1
 + mmh3==5.2.0
 + mpmath==1.3.0
 + msgpack==1.1.1
 + msgspec==0.19.0
 + murmurhash==1.0.13
 + narwhals==2.5.0
 + numba==0.62.0
 + nvidia-cublas-cu12==12.8.4.1
 + nvidia-cuda-cupti-cu12==12.8.90
 + nvidia-cuda-nvrtc-cu12==12.8.93
 + nvidia-cuda-runtime-cu12==12.8.90
 + nvidia-cudnn-cu12==9.10.2.21
 + nvidia-cufft-cu12==11.3.3.83
 + nvidia-cufile-cu12==1.13.1.3
 + nvidia-curand-cu12==10.3.9.90
 + nvidia-cusolver-cu12==11.7.3.90
 + nvidia-cusparse-cu12==12.5.8.93
 + nvidia-cusparselt-cu12==0.7.1
 + nvidia-nccl-cu12==2.27.3
 + nvidia-nvjitlink-cu12==12.8.93
 + nvidia-nvtx-cu12==12.8.90
 + onnxruntime==1.23.0
 + optuna==4.5.0
 + pandas==2.3.2
 + pillow==11.3.0
 + plotly==6.3.0
 + polars==1.33.1
 + pondpond==1.4.1
 + preshed==3.0.10
 + py-rust-stemmers==0.1.5
 + pyarrow==21.0.0
 + pydeck==0.9.1
 + pynndescent==0.5.13
 + pytz==2025.2
 + ray==2.49.2
 + safetensors==0.6.2
 + scikit-learn==1.7.2
 + scipy==1.16.2
 + sentence-transformers==5.1.1
 + smart-open==7.3.1
 + smmap==5.0.2
 + spacy==3.8.7
 + spacy-legacy==3.0.12
 + spacy-loggers==1.0.5
 + srsly==2.5.1
 + streamlit==1.50.0
 + sympy==1.14.0
 + thinc==8.3.6
 + threadpoolctl==3.6.0
 + tokenizers==0.22.1
 + toml==0.10.2
 + torch==2.8.0
 + tornado==6.5.2
 + transformers==4.56.2
 + triton==3.4.0
 + tzdata==2025.2
 + umap-learn==0.5.9.post2
 + wasabi==1.1.3
 + watchdog==6.0.0
 + weasel==0.4.1
 + wsproto==1.2.0
task: [coverage] echo "[coverage] erasing previous data"
[coverage] erasing previous data
task: [coverage] uv run coverage erase
task: [coverage] echo "[coverage] running unit tests"
[coverage] running unit tests
task: [coverage] uv run pytest -vv --maxfail=1 --durations=10 -x tests/unit -m 'not slow' \
  --cov=src --cov-report=term-missing --cov-append

===================================================== test session starts ======================================================
platform linux -- Python 3.12.10, pytest-8.4.2, pluggy-1.6.0 -- /workspace/autoresearch/.venv/bin/python3
cachedir: .pytest_cache
hypothesis profile 'default'
benchmark: 5.1.0 (defaults: timer=time.perf_counter disable_gc=False min_rounds=5 min_time=0.000005 max_time=1.0 calibration_precision=10 warmup=False warmup_iterations=100000)
rootdir: /workspace/autoresearch
configfile: pytest.ini
plugins: hypothesis-6.140.2, bdd-8.1.0, httpx-0.35.0, anyio-4.11.0, benchmark-5.1.0, cov-7.0.0, langsmith-0.4.31
collecting ... collected 1015 items / 25 deselected / 990 selected

tests/unit/distributed/test_coordination_properties.py::test_election_converges_to_minimum PASSED                        [  0%]
tests/unit/distributed/test_coordination_properties.py::test_election_requires_identifier PASSED                         [  0%]
tests/unit/distributed/test_coordination_properties.py::test_election_accepts_strings PASSED                             [  0%]
tests/unit/distributed/test_coordination_properties.py::test_message_processing_is_idempotent PASSED                     [  0%]
tests/unit/distributed/test_coordination_properties.py::test_message_processing_returns_copy PASSED                      [  0%]
tests/unit/distributed/test_coordination_properties.py::test_module_exports_helpers PASSED                               [  0%]
tests/unit/evidence/test_stability_utils.py::test_aggregate_entailment_scores_stable PASSED                              [  0%]
tests/unit/evidence/test_stability_utils.py::test_aggregate_entailment_scores_unstable PASSED                            [  0%]
tests/unit/evidence/test_stability_utils.py::test_sample_paraphrases_returns_unique_variants PASSED                      [  0%]
tests/unit/orchestration/test_budgeting_algorithm.py::test_budget_scaled_by_loops_and_limits PASSED                      [  1%]
tests/unit/orchestration/test_budgeting_algorithm.py::test_budget_minimum_buffer_applied PASSED                          [  1%]
tests/unit/orchestration/test_budgeting_algorithm.py::test_budget_unchanged_within_bounds PASSED                         [  1%]
tests/unit/orchestration/test_circuit_breaker_determinism.py::test_circuit_breaker_determinism_and_recovery PASSED       [  1%]
tests/unit/orchestration/test_circuit_breaker_thresholds.py::test_circuit_breaker_threshold_and_recovery PASSED          [  1%]
tests/unit/orchestration/test_gate_policy.py::test_scout_gate_reduces_loops_when_signals_low FAILED                      [  1%]

=========================================================== FAILURES ===========================================================
________________________________________ test_scout_gate_reduces_loops_when_signals_low ________________________________________

    def test_scout_gate_reduces_loops_when_signals_low() -> None:
        """High overlap and low conflict skip debate and estimate token savings."""
    
        config = _make_config(token_budget=120, loops=3)
        state = QueryState(query="What is the capital of France?", primus_index=0, coalitions={})
        metrics = OrchestrationMetrics()
    
        by_backend = {
            "duckduckgo": [
                {
                    "url": "https://example.com/paris",
                    "title": "Paris - Wikipedia",
                    "snippet": "What is the capital of France? It is Paris, the capital of France.",
                },
                {
                    "url": "https://example.com/history",
                    "title": "History of Paris",
                    "snippet": "Paris has long served as France's capital city.",
                },
            ],
            "serper": [
                {
                    "url": "https://example.com/paris",
                    "title": "Paris - Wikipedia",
                    "snippet": "Paris, the capital city of France, sits on the Seine river.",
                },
                {
                    "url": "https://example.com/overview",
                    "title": "France Overview",
                    "snippet": "France designates Paris as its capital and largest city.",
                },
            ],
        }
        ranked = [dict(doc) for docs in by_backend.values() for doc in docs]
    
        with SearchContext.temporary_instance() as context:
            context.record_scout_observation(state.query, ranked, by_backend=by_backend)
            decision = OrchestrationUtils.evaluate_scout_gate_policy(
                query=state.query,
                config=config,
                state=state,
                loops=config.loops,
                metrics=metrics,
            )
    
        assert isinstance(decision, ScoutGateDecision)
>       assert decision.should_debate is False
E       AssertionError: assert True is False
E        +  where True = ScoutGateDecision(should_debate=True, target_loops=3, heuristics={'retrieval_overlap': 0.3333333333333333, 'nli_conflict': 0.5305059523809524, 'complexity': 0.04300000000000001}, thresholds={'retrieval_overlap': 0.6, 'nli_conflict': 0.3, 'complexity': 0.5}, reason='policy_enabled', tokens_saved=0).should_debate

/workspace/autoresearch/tests/unit/orchestration/test_gate_policy.py:69: AssertionError
----------------------------------------------------- Captured stderr call -----------------------------------------------------
{"text": "2025-09-28 03:14:28.488 | INFO     | autoresearch.logging_utils:emit:113 - No configuration file found; using defaults\n", "record": {"elapsed": {"repr": "0:00:36.389903", "seconds": 36.389903}, "exception": null, "extra": {}, "file": {"name": "logging_utils.py", "path": "/workspace/autoresearch/src/autoresearch/logging_utils.py"}, "function": "emit", "level": {"icon": "ℹ️", "name": "INFO", "no": 20}, "line": 113, "message": "No configuration file found; using defaults", "module": "logging_utils", "name": "autoresearch.logging_utils", "process": {"id": 5920, "name": "MainProcess"}, "thread": {"id": 140213277989760, "name": "MainThread"}, "time": {"repr": "2025-09-28 03:14:28.488911+00:00", "timestamp": 1759029268.488911}}}
{"text": "2025-09-28 03:14:28.490 | WARNING  | autoresearch.logging_utils:emit:113 - {\"event\": \"spaCy model 'en_core_web_sm' not found. Set AUTORESEARCH_AUTO_DOWNLOAD_SPACY_MODEL=true to download automatically.\", \"timestamp\": \"2025-09-28T03:14:28.490524Z\"}\n", "record": {"elapsed": {"repr": "0:00:36.391670", "seconds": 36.39167}, "exception": null, "extra": {}, "file": {"name": "logging_utils.py", "path": "/workspace/autoresearch/src/autoresearch/logging_utils.py"}, "function": "emit", "level": {"icon": "⚠️", "name": "WARNING", "no": 30}, "line": 113, "message": "{\"event\": \"spaCy model 'en_core_web_sm' not found. Set AUTORESEARCH_AUTO_DOWNLOAD_SPACY_MODEL=true to download automatically.\", \"timestamp\": \"2025-09-28T03:14:28.490524Z\"}", "module": "logging_utils", "name": "autoresearch.logging_utils", "process": {"id": 5920, "name": "MainProcess"}, "thread": {"id": 140213277989760, "name": "MainThread"}, "time": {"repr": "2025-09-28 03:14:28.490678+00:00", "timestamp": 1759029268.490678}}}
------------------------------------------------------ Captured log call -------------------------------------------------------
INFO     autoresearch.config.loader:loader.py:186 No configuration file found; using defaults
WARNING  autoresearch.search.context:context.py:227 {"event": "spaCy model 'en_core_web_sm' not found. Set AUTORESEARCH_AUTO_DOWNLOAD_SPACY_MODEL=true to download automatically.", "timestamp": "2025-09-28T03:14:28.490524Z"}
--------------------------------------------------- Captured stderr teardown ---------------------------------------------------
{"text": "2025-09-28 03:14:28.524 | INFO     | autoresearch.logging_utils:emit:113 - No configuration file found; using defaults\n", "record": {"elapsed": {"repr": "0:00:36.425346", "seconds": 36.425346}, "exception": null, "extra": {}, "file": {"name": "logging_utils.py", "path": "/workspace/autoresearch/src/autoresearch/logging_utils.py"}, "function": "emit", "level": {"icon": "ℹ️", "name": "INFO", "no": 20}, "line": 113, "message": "No configuration file found; using defaults", "module": "logging_utils", "name": "autoresearch.logging_utils", "process": {"id": 5920, "name": "MainProcess"}, "thread": {"id": 140213277989760, "name": "MainThread"}, "time": {"repr": "2025-09-28 03:14:28.524354+00:00", "timestamp": 1759029268.524354}}}
---------------------------------------------------- Captured log teardown -----------------------------------------------------
INFO     autoresearch.config.loader:loader.py:186 No configuration file found; using defaults
======================================================= warnings summary =======================================================
.venv/lib/python3.12/site-packages/hdbscan/plots.py:448
  /workspace/autoresearch/.venv/lib/python3.12/site-packages/hdbscan/plots.py:448: SyntaxWarning: invalid escape sequence '\l'
    axis.set_ylabel('$\lambda$ value')

.venv/lib/python3.12/site-packages/hdbscan/robust_single_linkage_.py:175
  /workspace/autoresearch/.venv/lib/python3.12/site-packages/hdbscan/robust_single_linkage_.py:175: SyntaxWarning: invalid escape sequence '\{'
    $max \{ core_k(a), core_k(b), 1/\alpha d(a,b) \}$.

.venv/lib/python3.12/site-packages/spacy/cli/_util.py:23
  /workspace/autoresearch/.venv/lib/python3.12/site-packages/spacy/cli/_util.py:23: DeprecationWarning: Importing 'parser.split_arg_string' is deprecated, it will only be available in 'shell_completion' in Click 9.0.
    from click.parser import split_arg_string

.venv/lib/python3.12/site-packages/weasel/util/config.py:8
  /workspace/autoresearch/.venv/lib/python3.12/site-packages/weasel/util/config.py:8: DeprecationWarning: Importing 'parser.split_arg_string' is deprecated, it will only be available in 'shell_completion' in Click 9.0.
    from click.parser import split_arg_string

-- Docs: https://docs.pytest.org/en/stable/how-to/capture-warnings.html
===================================================== slowest 10 durations =====================================================
5.22s call     tests/unit/distributed/test_coordination_properties.py::test_message_processing_is_idempotent
1.56s call     tests/unit/distributed/test_coordination_properties.py::test_election_converges_to_minimum
0.02s teardown tests/unit/distributed/test_coordination_properties.py::test_election_accepts_strings
0.02s teardown tests/unit/orchestration/test_gate_policy.py::test_scout_gate_reduces_loops_when_signals_low
0.02s setup    tests/unit/distributed/test_coordination_properties.py::test_election_converges_to_minimum
0.02s setup    tests/unit/evidence/test_stability_utils.py::test_sample_paraphrases_returns_unique_variants
0.02s setup    tests/unit/orchestration/test_gate_policy.py::test_scout_gate_reduces_loops_when_signals_low
0.02s setup    tests/unit/distributed/test_coordination_properties.py::test_module_exports_helpers
0.02s teardown tests/unit/distributed/test_coordination_properties.py::test_election_converges_to_minimum
0.02s teardown tests/unit/evidence/test_stability_utils.py::test_aggregate_entailment_scores_unstable
=================================================== short test summary info ====================================================
FAILED tests/unit/orchestration/test_gate_policy.py::test_scout_gate_reduces_loops_when_signals_low - AssertionError: assert True is False
 +  where True = ScoutGateDecision(should_debate=True, target_loops=3, heuristics={'retrieval_overlap': 0.3333333333333333, 'nli_conflict': 0.5305059523809524, 'complexity': 0.04300000000000001}, thresholds={'retrieval_overlap': 0.6, 'nli_conflict': 0.3, 'complexity': 0.5}, reason='policy_enabled', tokens_saved=0).should_debate
!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!! stopping after 1 failures !!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!
=================================== 1 failed, 14 passed, 25 deselected, 4 warnings in 17.85s ===================================
task: Failed to run task "coverage": exit status 1
