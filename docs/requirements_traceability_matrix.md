# Requirements Traceability Matrix

| Req ID | Description | Modules | Test(s) |
|--------|-------------|---------|---------|
| F-01 | CLI and API entry points | `main.py`, `api.py`, `mcp_interface.py`, `a2a_interface.py` | `tests/unit/test_main_cli.py`, `tests/unit/test_main_module.py`, `tests/unit/test_main_config_commands.py`, `tests/unit/test_main_backup_commands.py`, `tests/unit/test_main_monitor_commands.py`, `tests/unit/test_mcp_interface.py`, `tests/unit/test_a2a_interface.py`, `tests/integration/test_cli_http.py`, `tests/behavior/features/query_interface.feature`, `tests/behavior/features/api_orchestrator_integration.feature` |
| F-02 | Dialectical orchestration with rotating Primus | `orchestration/orchestrator.py`, `agents/` | `tests/unit/test_orchestrator_order.py`, `tests/unit/test_orchestrator_errors.py`, `tests/unit/test_agents_llm.py`, `tests/unit/test_specialized_agents.py`, `tests/behavior/features/agent_orchestration.feature`, `tests/behavior/features/orchestrator_agents_integration.feature`, `tests/behavior/features/orchestrator_agents_integration_extended.feature`, `tests/behavior/features/orchestration_system.feature` |
| F-03 | Retrieve external info with source metadata | `search.py`, `cache.py` | `tests/unit/test_search.py`, `tests/unit/test_cache.py`, `tests/unit/test_relevance_ranking.py`, `tests/unit/test_ranking_convergence.py`, `tests/integration/test_search_backends.py`, `tests/behavior/features/local_sources.feature`, `tests/behavior/features/cache_management.feature` |
| F-04 | Hybrid DKG persistence | `storage.py`, `storage_backends.py` | `tests/unit/test_duckdb_storage_backend.py`, `tests/unit/test_duckdb_storage_backend_extended.py`, `tests/unit/test_storage_persistence.py`, `tests/unit/test_storage_teardown.py`, `tests/unit/test_storage_utils.py`, `tests/unit/test_storage_backup.py`, `tests/unit/test_storage_persistence_eviction.py`, `tests/integration/test_rdf_persistence.py`, `tests/behavior/features/dkg_persistence.feature` |
| F-05 | Configurable loops and agent roster via TOML with hot reload | `config.py`, `main.py` | `tests/unit/test_config_reload.py`, `tests/unit/test_config_profiles.py`, `tests/unit/test_config_watcher_cleanup.py`, `tests/unit/test_main_config_commands.py`, `tests/behavior/features/configuration_hot_reload.feature` |
| F-06 | Schema-validated JSON and human-readable output | `output_format.py`, `models.py` | `tests/unit/test_output_format.py`, `tests/unit/test_template.py`, `tests/unit/test_models_docstrings.py`, `tests/unit/test_llm_docstrings.py`, `tests/behavior/features/output_formatting.feature` |
| F-07 | Prometheus metrics and monitoring | `orchestration/metrics.py`, `main.py`, `resource_monitor.py`, `monitor/` | `tests/unit/test_metrics.py`, `tests/integration/test_monitor_metrics.py`, `tests/unit/test_monitor_cli.py`, `tests/unit/test_metrics_extra.py`, `tests/behavior/features/interactive_monitor.feature` |
| F-08 | Interactive query mode | `main.py` | `tests/behavior/features/query_interface.feature` |
| F-09 | RAM budget enforcement and eviction | `storage.py` | `tests/unit/test_eviction.py`, `tests/unit/test_storage_eviction.py`, `tests/unit/test_storage_ram_usage.py`, `tests/unit/test_storage_persistence_eviction.py`, `tests/behavior/features/storage_search_integration.feature` |
| F-10 | Vector search in DuckDB | `storage.py`, `storage_backends.py` | `tests/unit/test_vector_search.py`, `tests/integration/test_vector_extension.py`, `tests/integration/test_vector_extension_extended.py`, `tests/behavior/features/vector_extension_handling.feature`, `tests/behavior/features/storage_search_integration.feature` |
| F-11 | Multiple LLM and search backends | `llm/`, `search.py` | `tests/unit/test_llm_adapter.py`, `tests/unit/test_llm_capabilities.py`, `tests/integration/test_search_backends.py` |
| F-12 | Multiple reasoning modes | `orchestration/reasoning.py` | `tests/unit/test_reasoning_modes.py`, `tests/unit/test_reasoning_strategy.py`, `tests/unit/test_ontology_reasoner_props.py`, `tests/integration/test_ontology_reasoning.py`, `tests/behavior/features/reasoning_mode.feature` |
| F-13 | Structured logging without secrets | `logging_utils.py`, `error_utils.py` | `tests/unit/test_logging_utils.py`, `tests/unit/test_logging_shutdown.py`, `tests/unit/test_errors.py`, `tests/behavior/features/orchestration_system.feature` |
| F-14 | Clear errors and configuration validation | `config.py`, `errors.py` | `tests/unit/test_config_errors.py`, `tests/unit/test_errors.py`, `tests/behavior/features/error_handling.feature` |
| F-15 | Comprehensive test coverage | `tests/` | all |
| F-16 | Extensible plugin architecture | `agents/registry.py`, `extensions.py` | `tests/unit/test_agent_registry.py`, `tests/unit/test_vss_extension_loader.py` |
| F-17 | CLI output adapts to context | `output_format.py`, `cli_utils.py` | `tests/unit/test_output_format.py`, `tests/behavior/features/output_formatting.feature` |
| F-18 | Accessible output | `output_format.py`, `ui/app.py` | `tests/behavior/features/ui_accessibility.feature` |
| F-19 | Local directory search | `search.py` | `tests/unit/test_search.py`, `tests/behavior/features/local_sources.feature` |
| F-20 | Local Git repository search | `search.py` | `tests/unit/test_search.py`, `tests/behavior/features/local_sources.feature` |
| F-21 | Maintain local indexes | `storage.py`, `search.py` | `tests/unit/test_incremental_updates.py`, `tests/unit/test_storage_validation.py`, `tests/behavior/features/storage_search_integration.feature` |
| F-22 | Cross-modal interface consistency | `main.py`, `ui/app.py` | `tests/behavior/features/cross_modal_integration.feature`, `tests/behavior/features/pyside6_gui.feature` |
| F-23 | Batch query endpoint | `api.py` | `tests/unit/test_api.py`, `tests/integration/test_api_streaming.py`, `tests/integration/test_cli_http.py`, `tests/behavior/features/api_orchestrator_integration.feature` |
| F-24 | API auth handshake; constant-time token checks | `api.py`, `api/utils.py` | `tests/integration/test_api_auth.py`, `tests/integration/test_api_auth_failure.py`, `tests/behavior/features/api_auth.feature` |
| F-25 | Textual dashboard entrypoint with graceful fallback | `main/app.py`, `cli_utils.py`, `monitor/`, `ui/tui/` | `tests/behavior/features/terminal_dashboard.feature`, integration smoke tests (planned) |
| F-26 | Enhanced interactive prompts with prompt-toolkit | `main/app.py`, `prompting/prompt_service.py` | `tests/behavior/features/enhanced_prompting.feature`, targeted unit tests (planned) |
| F-27 | Rich layouts with deterministic bare-mode fallbacks | `cli_utils.py`, `monitor/visualization.py` | `tests/behavior/features/rich_monitor_layout.feature`, `tests/behavior/features/visualize_metrics_cli.feature` |
| F-28 | Workspace manifests version curated resources and citation requirements | `storage.py`, `storage_backends.py` | `tests/unit/storage/test_workspace_manifest.py`, `tests/behavior/features/research_federation.feature` |
| F-29 | Workspace-aware orchestration enforces citation coverage | `orchestration/workspace.py`, `main/app.py` | `tests/unit/orchestration/test_workspace_orchestrator.py`, `tests/behavior/features/research_federation.feature` |
| F-30 | Workspace tooling across CLI and desktop surfaces manifest context; `search manifest` CLI covers repository curation | `main/app.py`, `ui/desktop/main_window.py` | `tests/ui/desktop/test_desktop_integration.py`, `tests/behavior/features/research_federation.feature` |
| F-31 | Scholarly connectors cache papers with provenance for offline replay | `resources/scholarly/`, `storage.py` | `tests/behavior/features/research_federation.feature`, connector unit tests (planned) |

