# v0.1.0a1 preflight readiness plan (2025-10-04)

This revision applies a multi-disciplinary, dialectical, and Socratic
analysis to the current alpha release posture. It replaces the superseded
October 5 snapshot and focuses on the freshest evidence gathered during the
October 4 triage cycle.

## Evidence snapshot

- `uv run mypy --strict src tests` continues to pass, confirming the strict
  gate remains green while we repair the pytest regressions uncovered in the
  latest sweep.【a78415†L1-L2】
- Fallback placeholders now carry canonical URLs and backend labels via
  `Search._normalise_backend_documents`, and the refreshed unit tests cover the
  stub backend, fallback return-handles, and failure scenarios paths; the
  current `task verify` sweep reaches these passing assertions before
  `test_parallel_merging_is_deterministic` re-fails with the known `TypeError`.
  【F:src/autoresearch/search/core.py†L842-L918】【F:tests/unit/test_core_modules_additional.py†L134-L215】【F:tests/unit/test_failure_scenarios.py†L43-L86】【4c0de7†L1-L120】
- `uv run --extra test pytest` now fails with ten regressions that cluster
  around search backends, cache determinism, orchestrator determinism,
  reasoning telemetry, and output formatting edge cases, establishing the
  highest-impact blockers to the alpha tag.【53776f†L1-L60】
- Targeted property-based tests show OutputFormatter drops control
  characters and collapses whitespace, while cache tests prove backend calls
  still fire on cache hits, highlighting concrete failure modes we must
  address before rerunning the full suite.【5f96a8†L12-L36】【e865e9†L1-L58】
- Focused orchestration and reasoning tests demonstrate that debate
  telemetry currently mutates answers with warning banners and that the
  parallel merge path no longer returns hashable reasoning steps, creating
  correctness risks for downstream consumers.【cf191d†L27-L46】【53776f†L22-L38】
- Search integration tests show the DuckDuckGo stub diverges from the mocked
  query payload and that hybrid ranking now calls patched hooks with the
  wrong signature, confirming the need for renewed backend determinism.
  【34ebc5†L1-L76】

## Dialectical review of active blockers

### Search backend determinism
- **Assumption:** Restoring deterministic request payloads and backend
  signatures will unblock the majority of search failures.
- **Support:** The DuckDuckGo mock rejects the call because the request
  query preserves question punctuation, and the hybrid ranker now invokes
  a patched helper with the wrong arity.【34ebc5†L17-L70】
- **Counterpoint:** Normalising payloads without reviewing cache keys could
  cause hard-to-diagnose mismatches in production telemetry.
- **Synthesis:** Ship a focused PR that (1) reintroduces query canonical
  forms for stubs, (2) restores the cross-backend rank signature and
  adapter hooks, and (3) refreshes unit fixtures to assert both the raw and
  canonical query values.

### Search cache semantics
- **Assumption:** Cache regressions stem from bypassing namespace-aware keys
  when embeddings or storage shims are active.
- **Support:** The property-based cache test records three backend calls for
  an identical query, proving cache misses despite persisted artifacts.
  【e865e9†L15-L52】
- **Counterpoint:** Forcing cache hits without auditing embedding metadata
  risks staleness for hybrid queries.
- **Synthesis:** Introduce a namespace + embedding signature key helper,
  add Socratic assertions that question when hybrid metadata should bypass
  cache reuse, and extend unit tests to cover sequential and interleaved
  cache hits.

### Output formatting fidelity
- **Assumption:** OutputFormatter must preserve control characters and
  whitespace to avoid silently corrupting responses.
- **Support:** Hypothesis finds failing cases where control characters are
  dropped from markdown output and where answers collapse to empty strings
  in JSON.【5f96a8†L12-L36】
- **Counterpoint:** Blindly echoing unescaped control characters could break
  downstream renderers or leak unsafe data.
- **Synthesis:** Encode a conservative escaping strategy that preserves
  byte fidelity in JSON while sanitising markdown through explicit code
  fencing, and add property tests that interrogate the escaping rules.

### Orchestrator determinism and telemetry
- **Assumption:** Deterministic orchestration is critical for reproducible
  audits and accurate behaviour coverage.
- **Support:** The parallel merge test now raises `TypeError` because
  reasoning steps contain dicts instead of strings, and the benchmarking
  harness fails its throughput floor.【53776f†L22-L34】【53776f†L34-L44】
- **Counterpoint:** Tightening determinism without tracing why dicts leak
  into reasoning could hide deeper regressions in agent outputs.
- **Synthesis:** Patch the merge reducer to normalise reasoning payloads,
  audit the aggregator contract with Socratic prompts in tests, and
  recalibrate the scheduler benchmark using recorded baseline metrics
  rather than hard-coded floors.

### Reasoning telemetry hygiene
- **Assumption:** Chain-of-thought answers should remain verbatim, with
  warnings exposed separately.
- **Support:** The reasoning modes test now sees warning banners appended to
  the final answer, violating the documented API contract.【cf191d†L27-L46】
- **Counterpoint:** Removing warnings entirely could reduce user awareness
  of audit gaps.
- **Synthesis:** Move warning banners into structured telemetry fields,
  leaving the textual answer untouched while updating behaviour coverage to
  verify both the banner presence and the unmodified answer string.

## Proposed PR slices

Each slice is scoped to minimise turnaround while applying the dialectical
conclusions above.

1. **PR-S1 Search stub normalisation**
   - Canonicalise outbound queries, restore cross-backend rank signatures,
     and add regression tests for DuckDuckGo, hybrid ranking, and local file
     fallbacks.
   - Update cache fixtures to verify canonical and raw query logging.
2. **PR-S2 Cache namespace guards**
   - Introduce a dedicated cache key builder that incorporates embedding and
     storage hints, backfill docstrings, and expand property-based tests to
     interrogate sequential cache hits.
3. **PR-O1 Output formatter fidelity**
   - Implement JSON whitespace preservation, markdown escaping, and add
     Hypothesis strategies for control characters and whitespace-only
     answers.
4. **PR-R1 Reasoning telemetry separation**
   - Decouple warning banners from answer strings, expose structured
     warnings, and extend behaviour tests to assert clean answers plus
     telemetry fields.
5. **PR-P1 Orchestrator determinism + scheduler benchmarks**
   - Normalise reasoning payloads before merging, record throughput baselines
     in fixtures, and tune benchmark expectations using captured metrics.

A follow-up PR sweep (PR-S3) can concentrate on hybrid embedding cache reuse
once S1 and S2 land, while PR-O2 can add documentation updates for formatter
contracts after O1 merges. TestPyPI remains out of scope until these slices
restore a green suite.

## Behaviour and coverage strategy

- Re-run the full behaviour suite after PR-S1 and PR-R1 merge to confirm
  user workflows still capture unmodified answers and warning telemetry.
- Maintain coverage ≥90 % by extending property-based suites with the new
  fixtures introduced above. The search cache property test already seeds a
  coverage gap we will close once the namespace helper lands.【e865e9†L15-L52】
- Document each regression fix in `STATUS.md`, `TASK_PROGRESS.md`, and the
  alpha issue so future reviewers can trace evidence without relying on the
  superseded October 5 logs.

## Immediate next actions

- [ ] Draft PR-S1 with deterministic stubs, hybrid ranking signature fixes,
  and refreshed search fixtures.
- [ ] Draft PR-S2 introducing the namespace-aware cache key helper and
  expanded property tests.
- [ ] Draft PR-O1 to preserve formatting fidelity for JSON and markdown.
- [ ] Draft PR-R1 to relocate warning banners into structured telemetry and
  update behaviour coverage.
- [ ] Draft PR-P1 to normalise reasoning merges and calibrate scheduler
  benchmarks.
- [ ] Re-run `uv run --extra test pytest` after the above PRs land to confirm
  a green suite before re-enabling the coverage and release sweeps.
