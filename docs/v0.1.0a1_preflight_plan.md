# v0.1.0a1 preflight readiness plan (2025-10-07 04:38 UTC)

This revision applies a multi-disciplinary, dialectical, and Socratic
analysis to the current alpha release posture. It replaces the superseded
October 5 snapshot and incorporates the lint fallout observed after the
latest verify sweep.

## Evidence snapshot

- `uv run task check` at **04:38 UTC on October 7, 2025** clears `flake8` and the
  repo-wide strict gate before `check_spec_tests.py` lists the missing
  specification anchors, recording the current blocker for the quick gate in
  `baseline/logs/task-check-20251007T0438Z.log`.【F:baseline/logs/task-check-20251007T0438Z.log†L1-L165】
- Summariser, critic, and fact-checker agents now coerce
  `FrozenReasoningStep` payloads into dictionaries before generating prompts,
  and the orchestration state regression extends `ReasoningCollection` via
  another `ReasoningCollection` instance, keeping strict typing green while
  preserving deterministic reasoning order.【F:src/autoresearch/agents/specialized/summarizer.py†L9-L78】
  【F:src/autoresearch/agents/specialized/critic.py†L9-L101】
  【F:src/autoresearch/agents/dialectical/fact_checker.py†L360-L426】
  【F:tests/unit/orchestration/test_query_state_features.py†L140-L160】
- `uv run mypy --strict src tests` at **04:53 UTC on October 6, 2025** reports
  “Success: no issues found in 794 source files”, confirming the strict gate
  stays green after the latest merges.【4fb61a†L1-L2】
- `uv run mypy --strict src tests` at **16:05 UTC on October 5, 2025** reports
  “Success: no issues found in 205 source files”, keeping the strict gate
  green for alpha triage.【daf290†L1-L2】
- A focused `pytest` target confirms the AUTO mode regression
  (`tests/unit/orchestration/test_auto_mode.py::
  test_auto_mode_returns_direct_answer_when_gate_exits`)
  fails because AUTO mode drops the synthesiser’s claim list, leaving scout
  samples without content; we halted the broad test run after verifying this
  regression to avoid cascading failures.【349e1c†L1-L64】【c59d05†L1-L7】
- `uv run --extra test pytest tests/unit/legacy/test_cache.py -k cache` now passes,
  confirming the namespace-aware slot builder and inline fixtures keep backend
  invocations to one per unique key while upgrading aliases across namespaces.
  【816271†L1-L3】【F:tests/unit/legacy/test_cache.py†L503-L608】
  【F:tests/unit/legacy/test_cache.py†L779-L879】【F:tests/unit/legacy/test_cache.py†L883-L1010】
- Fallback placeholders now carry canonical URLs and backend labels via
  `Search._normalise_backend_documents`; `task verify` reaches those assertions
  before the known `test_parallel_merging_is_deterministic` failure recurs,
  confirming search metadata fixes held through the latest sweep.
  【F:src/autoresearch/search/core.py†L842-L918】
  【F:tests/unit/test_core_modules_additional.py†L134-L215】
  【F:tests/unit/test_failure_scenarios.py†L43-L86】
  【F:baseline/logs/task-verify-20251005T012754Z.log†L1-L196】
- Property-based cache probes now enforce deterministic namespace splits and
  confirm backend invocations collapse after the first unique fingerprint, while
  behaviour tests still record warning banners inside final answers, keeping the
  regression clusters prioritised for the next set of PR slices.
  【F:tests/unit/legacy/test_cache.py†L503-L608】【F:tests/unit/legacy/test_cache.py†L779-L879】
  【F:tests/unit/legacy/test_cache.py†L883-L1010】【cf191d†L27-L46】
- A full `uv run --extra test pytest` sweep at **04:53 UTC on October 6, 2025**
  halts during collection with 19 errors. The trace enumerates missing
  `tests/unit/legacy/typing_helpers.py`, `tests/scripts/check_env.py`,
  `tests/scripts/distributed_perf_sim.py`, and
  `tests/scripts/download_duckdb_extensions.py` modules plus the absent
  `tests/baseline/evaluation/scheduler_benchmark.json` fixture referenced by
  the harness.【364b98†L1-L60】
- Regenerated the scheduler benchmark baseline on **October 6, 2025 at
  15:04 UTC** via `uv run scripts/scheduling_resource_benchmark.py --max-workers
  2 --arrival-rate 3 --service-rate 5 --tasks 50 --mem-per-task 0.5`, recording
  throughput and memory floors with provenance metadata for audit reuse.
  【F:baseline/evaluation/scheduler_benchmark.json†L1-L15】
- After wiring the legacy suites to the repository `scripts/` directory and
  shared typing helpers, `uv run --extra test pytest tests/unit/legacy -k cache`
  now collects successfully and reaches the known cache assertion failure,
  confirming fixtures load again.【f1459e†L1-L131】
- A fresh **04:41 UTC on October 6, 2025** `uv run task verify` sweep fails in
  `flake8` with unused imports, duplicate definitions, and newline violations
  introduced by the merged search, cache, and AUTO telemetry changes; mypy and
  pytest do not execute until the lint fallout is resolved.
  【F:baseline/logs/task-verify-20251006T044116Z.log†L1-L124】
- `uv run task check` at **14:38 UTC on October 6, 2025** now clears `flake8`
  and `mypy` before `check_spec_tests.py` lists the long-standing missing
  documentation/test mappings, so lint fallout is resolved while spec coverage
  remains the blocker for a green sweep.
  【F:baseline/logs/task-check-20251006T143809Z.log†L1-L160】
- The paired coverage attempt at **04:41 UTC** starts compiling GPU and
  analysis extras (for example `hdbscan==0.8.40`) and was aborted to preserve
  the evaluation window; the partial log documents the stalled sweep for the
  follow-up run after lint repairs.【F:baseline/logs/task-coverage-20251006T044136Z.log†L1-L8】

## Dialectical review of active blockers

### Search backend determinism
- **Assumption:** Restoring deterministic request payloads and backend
  signatures will unblock the majority of search failures.
- **Support:** The DuckDuckGo mock rejects the call because the request
  query preserves question punctuation, and the hybrid ranker now invokes
  a patched helper with the wrong arity.【34ebc5†L17-L70】
- **Counterpoint:** Normalising payloads without reviewing cache keys could
  cause hard-to-diagnose mismatches in production telemetry.
- **Synthesis:** Ship a focused PR that (1) reintroduces query canonical
  forms for stubs, (2) restores the cross-backend rank signature and
  adapter hooks, and (3) refreshes unit fixtures to assert both the raw and
  canonical query values.

#### Stub contract
- `ExternalLookupResult` now surfaces `raw_query`, `executed_query`, and
  canonical forms so caches, telemetry, and stubs observe consistent
  payloads.
- Hybrid enrichment pushes query metadata onto the diagnostic stack,
  ensuring `add_embeddings` captures retrieval and fallback phases with
  matching canonical queries.
- Refreshed fixtures cover DuckDuckGo and local file regressions while
  asserting the raw-versus-canonical contract for both stub paths.

### Search cache semantics
- **Assumption:** Cache regressions stemmed from bypassing namespace-aware keys
  when embeddings or storage shims were active.
- **Support:** The refreshed property suite alternates namespaces per draw,
  verifies alias upgrades, and asserts backend invocations plateau after the
  first unique fingerprint, demonstrating the slot builder works as intended.
  【F:tests/unit/legacy/test_cache.py†L503-L608】【F:tests/unit/legacy/test_cache.py†L779-L879】
  【F:tests/unit/legacy/test_cache.py†L883-L1010】
- **Counterpoint:** The suite still exercises a single-process cache; multi-
  process or service-isolated deployments could uncover metadata drift despite
  the helper.
- **Socratic check:** What evidence would show cache keys stay stable across
  processes? Only integration probes that mix namespaces and storage hints under
  separate worker lifecycles will validate the helper beyond unit scope.
- **Synthesis:** Expand integration coverage around the helper, then pair it
  with behaviour telemetry fixes so warning banners no longer leak into final
  answers while the cache remains deterministic.

### Output formatting fidelity
- **Assumption:** OutputFormatter must preserve control characters and
  whitespace to avoid silently corrupting responses.
- **Support:** Hypothesis finds failing cases where control characters are
  dropped from markdown output and where answers collapse to empty strings
  in JSON.【5f96a8†L12-L36】
- **Counterpoint:** Blindly echoing unescaped control characters could break
  downstream renderers or leak unsafe data.
- **Synthesis:** Encode a conservative escaping strategy that preserves
  byte fidelity in JSON while sanitising markdown through explicit code
  fencing, and add property tests that interrogate the escaping rules.

### Specification-test alignment
- **Assumption:** Linking each specification document to its enforcing tests
  is a mechanical documentation sweep that can unblock the quick gate without
  touching runtime code.
- **Support:** `check_spec_tests.py` now fails solely because spec files omit
  anchors despite `SPEC_COVERAGE.md` enumerating the canonical test mapping,
  so synchronising the docs will immediately restore `task check` parity.
  【F:baseline/logs/task-check-20251007T0438Z.log†L102-L165】
- **Counterpoint:** Hand-curating dozens of anchors risks drift the moment new
  tests land, making maintenance brittle.
- **Socratic check:** What evidence proves the mapping remains stable after the
  sweep? An automated include or shortcode that ingests the coverage table will
  keep docs and manifests in lockstep.
- **Synthesis:** Draft **PR-D0** to add templated reference blocks (or a shared
  include) to each spec that mirrors the entries in `SPEC_COVERAGE.md`, update
  the coverage spreadsheet in the same PR, and wire a smoke test that fails if
  the include drifts from the manifest.

### Orchestrator determinism and telemetry
- **Assumption:** Deterministic orchestration is critical for reproducible
  audits and accurate behaviour coverage.
- **Support:** The parallel merge test now raises `TypeError` because
  reasoning steps contain dicts instead of strings, and the benchmarking
  harness fails its throughput floor.【53776f†L22-L34】【53776f†L34-L44】
- **Fresh evidence:** AUTO mode’s early exit no longer hydrates scout claim
  payloads, so behaviour telemetry lacks the structured content the API
  contract promises.【349e1c†L1-L64】
- **Counterpoint:** Tightening determinism without tracing why dicts leak
  into reasoning could hide deeper regressions in agent outputs.
- **Socratic probe:** Which invariant must hold for AUTO mode samples to stay
  truthful? Every sample should expose both the textual answer and the claim
  metadata recorded by the synthesiser; a failing invariant highlights the
  missing persistence hook.
- **Synthesis:** Patch the merge reducer to normalise reasoning payloads,
  hydrate AUTO mode samples with persisted claims, audit the aggregator
  contract with Socratic prompts in tests, and recalibrate the scheduler
  benchmark using recorded baseline metrics rather than hard-coded floors.

### AUTO mode sample hydration
- **Assumption:** Rehydrating the synthesiser’s claims into AUTO mode telemetry
  will unblock both the failing unit test and downstream behaviour checks.
- **Support:** The failing unit test shows that samples currently hold empty
  claim lists even when the synthesiser reports claims through telemetry.
  【349e1c†L1-L64】
- **Counterpoint:** Blindly copying claims may reintroduce the dict leakage that
  broke the parallel merge invariant, so we must constrain the format.
- **Socratic check:** What question reveals whether claim normalisation is safe?
  “Which minimal schema lets behaviour consumers assert claim content without
  mutating orchestrator state?” The answer points to mapping-based snapshots
  independent of live objects.
- **Synthesis:** Introduce a claim snapshot helper that converts synthesiser
  claims into serialisable dataclasses, feed those snapshots into AUTO mode
  metrics, and extend behaviour coverage to assert the schema stays stable.

### Reasoning telemetry hygiene
- **Assumption:** Chain-of-thought answers should remain verbatim, with
  warnings exposed separately.
- **Support:** Behaviour coverage now asserts that CLI answers omit warning
  banners while the JSON payload and metrics mirror the structured warnings,
  preventing silent regressions.【F:tests/behavior/steps/reasoning_modes_auto_cli_cycle_steps.py†L685-L723】
- **Counterpoint:** Removing warnings entirely could reduce user awareness of
  audit gaps, so caution notes must still surface through depth notes and
  metrics.
- **Synthesis:** Strip trailing banners from `results.final_answer` before
  constructing the response and rely on structured telemetry for caution
  delivery, keeping the textual answer clean while preserving warnings for
  downstream renderers.【F:src/autoresearch/orchestration/state.py†L132-L206】

## High-impact readiness priorities (October 7, 2025)

We apply a dialectical and Socratic probe across the latest failures to
sequence fast-follow pull requests that keep each slice tightly scoped.

### PR-D0 – Synchronise specification anchors with test coverage
- **Assumption:** Mirroring `SPEC_COVERAGE.md` inside each spec will unblock the
  quick gate without refactoring runtime code.
- **Counterpoint:** Manually editing dozens of markdown files risks future
  drift once new tests land.
- **Socratic prompt:** How do we keep specs and manifests aligned after this
  sweep? Ship helpers that ingest the coverage manifest so future divergences
  fail fast.
- **Synthesis:** Create a short PR that introduces a shared include (or
  templated block) for spec-to-test references, updates every spec to reuse it
  (starting with the highest-traffic docs), and adds a pre-commit check tied to
  `SPEC_COVERAGE.md`.

### PR-L0 – Restore test module hygiene
- **Assumption:** Fixing duplicated imports and misplaced `__future__`
  statements is a mechanical cleanup suited for a focused PR.
- **Counterpoint:** Touching many files risks merge noise that obscures
  lingering behavioural regressions.
- **Socratic prompt:** Which minimal edits unblock both `flake8` and pytest
  collection without masking deeper failures? Only removing duplicated imports
  and reordering `__future__` directives satisfies both gates while keeping test
  logic intact.
- **Synthesis:** Ship a sweep that normalises import order, drops duplicates,
  and reruns `uv run task check` to document lint parity before continuing.

### PR-L1 – Rehydrate legacy script fixtures
- **Assumption:** Missing `tests/scripts/*.py` and baseline JSON artefacts cause
  deterministic FileNotFoundErrors seen in the latest pytest run.
- **Counterpoint:** Reintroducing large fixtures could bloat the repository and
  slow tests.
- **Socratic prompt:** What is the smallest artefact set that lets the legacy
  harness execute while keeping storage ephemeral? Re-exporting the original
  shim scripts and synthesising lightweight scheduler baselines satisfies the
  tests without reinstating heavy assets.
- **Synthesis:** Author a PR that restores the helper scripts under `tests/`
  (or updates imports to use `scripts/` directly), backfills the scheduler JSON
  from current benchmarks, and records provenance in `baseline/`.

### PR-R2 – Resume orchestrator regression fixes
- **Assumption:** Once collection succeeds, the remaining orchestrator and
  search regressions mirror the previously scoped PR-P1 and PR-O1 items.
- **Counterpoint:** Newly uncovered fixture failures may alter priorities once
  tests execute again.
- **Socratic prompt:** Which invariant must hold before we address deeper
  behavioural defects? Pytest must progress past collection so deterministic
  failures expose actionable stack traces.
- **Synthesis:** After PR-L0/L1 land, rerun the suite to refresh the failure
  surface, then slice PR-P1 (parallel merge determinism) and PR-O1 (formatter
  fidelity) as independent follow-ups with updated acceptance tests.

### PR-V1 – Re-establish coverage evidence
- **Assumption:** Once lint and collection unblock, `task verify` and
  `task coverage` can run without GPU extras to refresh the 92.4 % baseline.
- **Counterpoint:** Behavioural regressions could still fail verification, so
  coverage might remain stale.
- **Socratic prompt:** What evidence demonstrates readiness to proceed toward
  the release tag? Fresh verify and coverage logs anchored in October 2025 that
  document lint, mypy, pytest, and coverage success.
- **Synthesis:** After PR-L0/L1/PR-R2, capture new logs, update the release
  dossier, and unblock the final sign-off stage while keeping TestPyPI paused.

## Proposed PR slices

Each slice is scoped to minimise turnaround while applying the dialectical
conclusions above.

1. **PR-D0 Spec anchor synchronisation**
   - Introduce a reusable include or shortcode that ingests `SPEC_COVERAGE.md`
     entries and embed it across the specs that currently lack references.
   - Add a guard in `scripts/check_spec_tests.py` (or a companion script) that
     compares the include against the manifest so future drifts fail fast.
2. **PR-S1 Search stub normalisation**
   - Canonicalise outbound queries, restore cross-backend rank signatures,
     and add regression tests for DuckDuckGo, hybrid ranking, and local file
     fallbacks.
   - Update cache fixtures to verify canonical and raw query logging.
3. **PR-S2 Cache namespace guards**
   - Introduce a dedicated cache key builder that incorporates embedding and
     storage hints, backfill docstrings, and expand property-based tests to
     interrogate sequential cache hits.
   - Replace function-scoped fixtures in property tests with inline context
     managers to satisfy Hypothesis health checks.【bebacc†L5-L21】
4. **PR-R0 AUTO mode claim hydration**
   - Snapshot synthesiser claims into telemetry-friendly dictionaries,
     hydrate AUTO mode samples with the snapshots, and add regression tests
     that probe for non-empty claim lists.【349e1c†L1-L64】
5. **PR-O1 Output formatter fidelity**
   - Implement JSON whitespace preservation, markdown escaping, and add
     Hypothesis strategies for control characters and whitespace-only
     answers.
6. **PR-R1 Reasoning telemetry separation**
   - Decouple warning banners from answer strings, expose structured
     warnings, and extend behaviour tests to assert clean answers plus
     telemetry fields.
7. **PR-P1 Orchestrator determinism + scheduler benchmarks**
   - Normalise reasoning payloads before merging, record throughput baselines
     in fixtures, and tune benchmark expectations using captured metrics.
8. **PR-A1 Agent reasoning ingestion hygiene**
   - Ensure specialist agents coerce `FrozenReasoningStep` inputs into
     dictionaries before prompt construction, rename local variables to avoid
     type ambiguities, and extend orchestration regression tests to exercise
     `ReasoningCollection` in-place additions.

A follow-up PR sweep (PR-S3) can concentrate on hybrid embedding cache reuse
once S1 and S2 land, while PR-O2 can add documentation updates for formatter
contracts after O1 merges. TestPyPI remains out of scope until these slices
restore a green suite.

## Behaviour and coverage strategy

- Re-run the full behaviour suite after PR-S1 and PR-R1 merge to confirm
  user workflows still capture unmodified answers and warning telemetry.
- Maintain coverage ≥90 % by extending property-based suites with the new
  fixtures introduced above. The search cache property test already seeds a
  coverage gap we will close once the namespace helper lands.【e865e9†L15-L52】
- Document each regression fix in `STATUS.md`, `TASK_PROGRESS.md`, and the
  alpha issue so future reviewers can trace evidence without relying on the
  superseded October 5 logs.

## Immediate next actions

- [ ] Draft **PR-D0** to embed `SPEC_COVERAGE.md` anchors into each spec,
  introduce a reusable include, and update `scripts/check_spec_tests.py` to
  assert the mapping remains in sync with the manifest.
- [x] Land **PR-S1** – deterministic search stubs, hybrid ranking signature
  fixes, and refreshed fixtures are merged; canonical queries now flow through
  the stub contract and hybrid telemetry, and regression coverage keeps the
  contract stable.【F:src/autoresearch/search/core.py†L650-L686】【F:src/autoresearch/search/core.py†L1431-L1468】
  【F:tests/unit/legacy/test_cache.py†L503-L608】【F:tests/unit/legacy/test_cache.py†L779-L879】
- [x] Land **PR-S2** – namespace-aware cache keys and property fixtures are in
  place; Hypothesis now alternates namespaces and asserts backend calls plateau
  after the first unique fingerprint.【F:tests/unit/legacy/test_cache.py†L503-L608】
  【F:tests/unit/legacy/test_cache.py†L779-L879】
- [x] Land **PR-R0** – AUTO mode samples hydrate claim snapshots via the
  reasoning payload normalisers and parallel orchestrator merge, keeping
  telemetry dictionaries serialisable.【F:src/autoresearch/orchestration/reasoning_payloads.py†L1-L166】
  【F:src/autoresearch/orchestration/parallel.py†L191-L210】
- [ ] Draft **PR-O1** to preserve formatting fidelity for JSON and markdown.
- [ ] Draft **PR-R1** to separate warning banners from answer strings where
  behaviour coverage still reports leakage.
- [ ] Draft **PR-P1** to recalibrate scheduler benchmarks now that claim
  hydration and deterministic cache behaviour are merged.
- [x] Land **PR-A1** – specialist agents now normalise `FrozenReasoningStep`
  payloads before prompt construction and the orchestration regression suite
  extends `ReasoningCollection` in-place operations, so `mypy --strict`
  remains green while reasoning order stays deterministic.
- [ ] Repair the lint fallout introduced by PR-S1/S2/R0 so `uv run task verify`
  reaches mypy and pytest again, then rerun coverage with GPU extras disabled
  unless explicitly required.
