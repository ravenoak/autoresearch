# v0.1.0a1 preflight readiness plan (2025-10-04)

This review applies dialectical and Socratic reasoning to the
Autoresearch improvement proposal and the current release posture. The
goal is to surface the highest-impact work that unblocks the 0.1.0a1
alpha tag while keeping each change scoped to a small, review-friendly
pull request.

## Evidence snapshot

- `uv run mypy --strict src tests` at 05:34 UTC on October 4, 2025 again
  reported “Success: no issues found in 790 source files”, confirming the
  strict gate remains green ahead of the remaining pytest remediation.
  【c2f747†L1-L2】
- `uv run --extra test pytest` at 05:31 UTC on the same day now fails in
  `tests/unit/test_core_modules_additional.py::test_search_stub_backend`
  for both legacy and VSS-enabled paths; the instrumentation no longer
  records the expected `add_calls` and the fallback bundle preserves the
  templated query text. The run was interrupted after collecting this
  evidence to accelerate focused triage, so downstream failures were not
  re-evaluated in this pass.【81b49d†L25-L155】【81b49d†L156-L204】
- The October 3, 2025 wide pytest sweep remains informative: 26 failures
  and five errors still cover reverification defaults, backup rotation,
  cache determinism, FastMCP adapters, orchestrator error handling,
  planner metadata, storage contracts, and environment metadata checks.
  We keep that broader data set to ensure follow-on PRs continue to hit
  every regression cluster once the search stub repairs land.
  【ce87c2†L81-L116】

The plan below assumes strict typing stays green and concentrates on the
fastest path to a green test suite, refreshed coverage evidence, and the
architectural upgrades outlined in the improvement proposal.

## Dialectical evaluation of key initiatives

For each initiative we list the motivating assumption, supporting
arguments, counterpoints, and a synthesis that guides the immediate
next step.

### Adaptive orchestration gate

- **Assumption:** Always-on debate wastes compute and can trigger
  hallucinations.
- **Support:** Auto mode already exists but lacks quantitative
  telemetry on when to skip debate, leaving cost savings unproven.
- **Counterpoint:** Over-aggressive skipping could lower factuality if
  verification trails lag.
- **Synthesis:** Instrument the existing AUTO path with claim coverage
  and confidence metrics, log skip/escalate decisions, and gate debate
  on the recorded evidence. Ship telemetry first, then tune thresholds
  with offline replays.

### Planner–research–debate–verify (PRDV)

- **Assumption:** A lightweight planner increases coverage and keeps
  debate scoped.
- **Support:** Current planner emits linear task lists without
  dependency tracking or Socratic prompts, limiting oversight.
- **Counterpoint:** Adding orchestration complexity without stronger
  verification risks more failure points.
- **Synthesis:** Add dependency-aware plan nodes plus Socratic
  self-check prompts in planner output. Deliver as a prompt/schema
  change guarded by unit tests before touching agent routing logic.

### Retrieval 2.0

- **Assumption:** Static top-k retrieval causes citation blind spots.
- **Support:** Search cache regressions show the current layer still
  revisits stale results and lacks adaptive k.
- **Counterpoint:** Aggressive re-querying increases latency unless the
  cache behaves predictably.
- **Synthesis:** Fix cache determinism first, then introduce adaptive
  query sizing with logging to compare latency against factuality.

### Verification pipeline

- **Assumption:** Claim extraction plus retries lower hallucinations.
- **Support:** Tests reveal FactChecker now rejects missing
  configuration, so the pipeline is brittle.
- **Counterpoint:** Patching tests without fixing configuration will
  mask runtime errors.
- **Synthesis:** Define explicit FactChecker defaults, update the
  reverification configuration contract, and extend tests to cover both
  configured and default paths.

### Heterogeneous agents and tooling

- **Assumption:** Role-specific models reduce cost while preserving
  quality.
- **Support:** Current configuration relies on a single tier, so cost
  telemetry is theoretical.
- **Counterpoint:** Premature multi-model routing without guardrails
  could complicate incident response.
- **Synthesis:** Capture per-role latency and token usage using the
  current model first. Add configurable routing tables in a follow-up
  PR once telemetry makes trade-offs clear.

### Knowledge-graph integration

- **Assumption:** Making the knowledge graph first-class improves
  multi-hop reasoning.
- **Support:** Graph exports exist but tests show backup rotation and
  persistence regressions.
- **Counterpoint:** Persisting additional triples without stable
  backups risks data loss.
- **Synthesis:** Stabilize backup scheduler behaviour, then add KG
  consistency checks plus provenance guards once persistence is
  reliable.

## Fresh pytest diagnostics (2025-10-03 22:37 UTC)

### FactChecker defaults

- **Representative failures:**
  - `tests/unit/orchestration/test_reverify.py`:
    - `test_reverify_extracts_claims_and_retries`
- **Assumption:** Restoring default FactChecker configuration should
  unblock reverification retries.
- **Support:** The regression surfaces as a validation error complaining
  about missing configuration.
- **Counterpoint:** Hard-coding defaults without fixture opt-outs could
  hide legitimate misconfiguration.
- **Synthesis:** Provide explicit defaults in configuration factories
  while updating fixtures to assert opt-in overrides so tests can verify
  both configured and default flows.

### Backup scheduler

- **Representative failures:**
  - `tests/unit/storage/test_backup_scheduler.py`:
    - `test_scheduler_restarts_existing_timer`
    - `test_rotation_policy_removes_excess_and_stale_backups`
- **Assumption:** The scheduler should restart timers and prune backups
  deterministically.
- **Support:** Tests assert observed behaviour (missing cancellation,
  stale cleanup) and currently fail.
- **Counterpoint:** Simplistic fixes risk race conditions in production
  timers.
- **Synthesis:** Introduce deterministic timer handles in the scheduler
  abstraction and extend tests with Socratic prompts questioning
  cancellation semantics before touching production concurrency paths.

### Search cache and stubs

- **Representative failures:**
  - `tests/unit/test_cache.py::*`
  - `tests/unit/test_core_modules_additional.py::*`
  - `tests/unit/test_failure_scenarios.py::test_external_lookup_fallback`
- **Assumption:** Cache metadata drift stems from regressions in backend
  keys and stub fallbacks.
- **Support:** Assertions expect per-backend isolation and stub fallback
  responses.
- **Counterpoint:** Over-fitting to tests may reduce runtime resilience
  if fallback semantics change.
- **Synthesis:** Refactor cache keys via a dedicated helper, add
  Socratic checklists in tests to challenge fallback behaviour, and
  document backend contracts so runtime changes stay auditable.

### API and FastMCP

- **Representative failures:**
  - `tests/unit/test_api.py::test_fallback_multiple_ips`
  - `tests/unit/test_a2a_mcp_handshake.py::*`
  - `tests/unit/test_mcp_interface.py::test_client_server_roundtrip`
- **Assumption:** Missing exports and constructor signatures break API
  clients.
- **Support:** Attribute errors and unexpected kwargs confirm the
  breakage.
- **Counterpoint:** Re-exporting without integration coverage could
  reintroduce stale adapters.
- **Synthesis:** Restore exports through the package `__all__`, align
  FastMCP constructors with documented schemas, and add behaviour
  coverage for handshake retries.

### Orchestrator error handling

- **Representative failures:**
  - `tests/unit/test_orchestrator_errors.py::*`
  - `tests/unit/test_parallel_query_timeout_claims`
- **Assumption:** Error fallback should emit structured claim mappings.
- **Support:** Type errors show the pipeline now injects strings instead
  of mappings.
- **Counterpoint:** Tightening the schema could mask debugging strings.
- **Synthesis:** Update error-handling helpers to normalise claim
  payloads, retain debugging metadata under explicit keys, and add
  Socratic prompts in tests to question claim structure expectations.

### Planner metadata and documentation hygiene

- **Representative failures:**
  - `tests/unit/test_advanced_agents.py::test_planner_metadata`
  - `tests/unit/test_models_docstrings.py::test_class_docstrings`
- **Assumption:** Planner outputs and documentation lost required
  context during refactors.
- **Support:** Attribute errors and docstring assertions fail.
- **Counterpoint:** Reintroducing heavy fixtures may slow planner
  iterations.
- **Synthesis:** Provide lightweight metadata adapters in planner mocks
  and refresh docstrings with concise yet auditable descriptions,
  capturing trade-offs in documentation.

### Storage contracts

- **Representative failures:**
  - `tests/unit/test_incremental_updates.py`:
    - `test_persist_claim_triggers_index_refresh`
  - `tests/unit/test_duckdb_storage_backend.py`:
    - `TestDuckDBStorageBackend::test_run_migrations`
- **Assumption:** Storage initialisation and migrations drifted from
  deterministic expectations.
- **Support:** Tests observe missing knowledge graph initialisation and
  redundant migration writes.
- **Counterpoint:** Forcing eager initialisation may regress lazy-loading
  performance.
- **Synthesis:** Add guard rails ensuring test fixtures bootstrap
  storage deterministically while keeping production lazy paths
  documented and monitored.

### Environment and telemetry

- **Representative failures:**
  - `tests/unit/test_check_env_warnings.py::*`
  - `tests/unit/test_more_coverage.py::test_formattemplate_metrics`
- **Assumption:** Environment checks and telemetry helpers depend on
  metadata that recent refactors removed.
- **Support:** Errors cite missing package metadata and claim audit
  fields.
- **Counterpoint:** Reintroducing metadata blindly may duplicate build
  steps.
- **Synthesis:** Provide fixture-supplied metadata hooks, question each
  field’s provenance, and document the expected telemetry surface in
  specs.

## Highest-impact priorities

1. Restore a green pytest suite by fixing the clustered regressions above,
   starting with the search stub instrumentation gap observed on
   October 4 before iterating through FactChecker defaults, storage
   rotation, cache determinism, API adapters, and orchestrator error
   handling.
2. Refresh coverage evidence after the suite is green, keeping the 92.4%
   gate enforceable ahead of alpha tagging.
3. Instrument AUTO mode and planner output with the telemetry required to
   tune adaptive debate and PRDV upgrades without guesswork.
4. Document routing, verification, and retrieval decisions so reviewers can
   audit improvements without external context.

## Planned PR slices

Each bullet is scoped for a fast review cycle and can ship independently.
Sub-bullets outline the concrete tasks required for each slice.

1. **PR-A:** Normalize FactChecker defaults and update reverification
   fixtures so `test_reverify_extracts_claims_and_retries` passes while
   preserving opt-out coverage.
   - Define explicit FactChecker defaults inside configuration factories.
   - Update fixtures to assert both default and opt-out flows.
   - Extend tests with Socratic prompts that question retry coverage and
     claim extraction boundaries.
2. **PR-B:** Repair backup scheduler restart logic and rotation policy to
   satisfy `tests/unit/storage/test_backup_scheduler.py` without
   introducing timing flakiness.
   - Inject deterministic timer handles into scheduler abstractions.
   - Ensure cancellation flags flip before rotation assertions execute.
   - Add regression tests that probe restart semantics with dialectical
     checklists.
3. **PR-C:** Refactor search cache key derivation, backend isolation, and
   stub fallback handling so cache and stub suites pass with deterministic
   query preservation and restored `add_calls` instrumentation.
   - Restore stub `add_calls` bookkeeping with explicit phase labels.
   - Ensure fallback bundles echo caller queries rather than templated
     prompts.
   - Document backend key derivation and add targeted tests that challenge
     vector-search toggles via Socratic assertions.
4. **PR-D:** Restore `autoresearch.api.parse` exports and align FastMCP
   adapter construction with handshake tests, covering both API and MCP
   suites.
   - Re-export the parser entry point through package initialisers.
   - Synchronise FastMCP adapter signatures with documented schemas.
   - Expand handshake tests to probe retries and failure branches.
5. **PR-E:** Normalise orchestrator error claim payloads and parallel
   timeout messaging so error-handling suites reintroduce mapping-based
   claims and clear reasoning trails.
   - Convert string payloads back to structured mappings with debug keys.
   - Align timeout messaging with behaviour-suite expectations.
   - Add dialectical assertions contrasting debug versus user messages.
6. **PR-F:** Stabilise storage initialisation and migration contracts,
   ensuring knowledge-graph setup and migration idempotency satisfy the
   incremental update and DuckDB tests.
   - Add deterministic bootstrap helpers for knowledge-graph fixtures.
   - Guard migrations with idempotent checks and audit logging.
   - Extend incremental update tests with prompts questioning lazy versus
     eager loading.
7. **PR-G:** Provide planner metadata adapters and refreshed docstrings so
   planner metadata and documentation hygiene suites pass without slowing
   planner iterations.
   - Add lightweight metadata adapters in planner mocks.
   - Refresh docstrings with concise rationales referencing Socratic
     checkpoints.
   - Update documentation hygiene tests to cover the new descriptions.
8. **PR-H:** Supply environment metadata fixtures and telemetry guards for
   `check_env_warnings` and `formattemplate_metrics` coverage tests.
   - Provide fixture hooks that inject metadata without full build steps.
   - Harden telemetry helpers against missing optional dependencies.
   - Expand coverage tests with prompts verifying guardrail behaviour.
9. **PR-I:** After PR-A through PR-H land, capture a fresh coverage run
   and update release documentation with the new evidence.
   - Run `uv run task verify` with non-GPU extras and archive the logs.
   - Run `uv run task coverage` and refresh `coverage.xml` baselines.
   - Update `STATUS.md`, `TASK_PROGRESS.md`, `CODE_COMPLETE_PLAN.md`, and
     `docs/release_plan.md` with the new artefacts.
10. **PR-J:** Add AUTO mode telemetry, capturing skip/escalate decisions
    and evidence coverage for tuning once the suite is green.
    - Instrument AUTO decision points with coverage and confidence metrics.
    - Add behaviour tests under `reasoning_modes` that question skip versus
      escalate choices.
    - Document tuning guidelines in `docs/` using dialectical analyses.
11. **PR-K:** Introduce dependency-aware planner prompts with Socratic
    self-checks and regression coverage building on PR-J outputs.
    - Update planner schemas to express dependencies and self-check prompts.
    - Extend unit tests with counterexamples challenging dependency logic.
    - Document how planner outputs pair with AUTO telemetry for reviewers.

## Coverage and behaviour follow-up

- After PRs A–H, rerun `uv run task verify EXTRAS="nlp ui vss git
  distributed analysis llm parsers"` to confirm lint, mypy, and pytest
  gates are green.
- When the suite passes, capture a fresh `task coverage` log and update
  `docs/release_plan.md`, `STATUS.md`, `TASK_PROGRESS.md`, and
  `CODE_COMPLETE_PLAN.md` with the new evidence.
- Expand behaviour coverage by adding scenarios under the
  `reasoning_modes` tag that exercise AUTO telemetry once PR-J merges.

## Documentation actions

- Mirror this plan in `CODE_COMPLETE_PLAN.md`, `ROADMAP.md`, and the
  alpha release issue so the repository tells a consistent story.
- Add release notes summarising the restored tests and telemetry once
  coverage evidence is refreshed.

